---
parameters:
  - name: run_type
    type: string
    default: default

steps:
  - task: Bash@3
    displayName: "Install Terraform"
    inputs:
      targetType: "inline"
      script: "make tf-install"

  - task: GoTool@0
    displayName: "Install Go"
    inputs:
      version: "1.22.3"
    condition: and(succeeded(), eq('${{ parameters.run_type }}', 'unit'))

  - task: AzureCLI@2
    displayName: "Prepare Terraform Environment"
    inputs:
      azureSubscription: ado-mscet-cae-estf
      scriptLocation: scriptPath
      scriptPath: "tests/scripts/tf-prepare.sh"
      scriptType: bash
      failOnStandardError: true
